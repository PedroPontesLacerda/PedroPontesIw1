<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Formulário de Compra</title>
  <style>
    :root{
      --bg:#f6f8fb; --card:#ffffff; --accent:#2563eb; --muted:#6b7280;
      --radius:12px; --shadow: 0 6px 18px rgba(16,24,40,0.08);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:#111827; -webkit-font-smoothing:antialiased;
      display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .container{
      width:100%; max-width:980px;
      display:grid; grid-template-columns: 1fr 380px; gap:20px;
      align-items:start;
    }
    @media (max-width:880px){ .container{ grid-template-columns:1fr } }
    .card{ background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:20px; }
    h1{ font-size:1.25rem; margin:0 0 12px; }
    label{ display:block; font-size:0.9rem; margin-bottom:6px; color:var(--muted); }
    .field{ margin-bottom:14px; }
    input[type="text"], input[type="email"], input[type="tel"], input[type="number"], select, textarea{
      width:100%; padding:10px 12px; border-radius:8px; border:1px solid #e6e9ef; font-size:0.95rem;
      box-sizing:border-box;
    }
    input:focus, select:focus, textarea:focus{ outline:2px solid rgba(37,99,235,0.12); border-color:rgba(37,99,235,0.28); }
    .grid2{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    .small{ font-size:0.85rem; color:var(--muted); }
    .btn{
      display:inline-block; background:var(--accent); color:white; padding:10px 14px; border-radius:10px;
      border:none; font-weight:600; cursor:pointer;
    }
    .btn:disabled{ opacity:0.6; cursor:not-allowed }
    .summary{ font-size:0.95rem; color:#111827; }
    .summary .row{ display:flex; justify-content:space-between; margin-bottom:10px; }
    .muted{ color:var(--muted); font-size:0.88rem; }
    .notice{ background:#fffbeb; border:1px solid #fef3c7; padding:8px 10px; border-radius:8px; color:#92400e; margin-bottom:12px; }
    .product-card{ display:flex; gap:12px; align-items:center; }
    .product-thumb{ width:64px; height:64px; background:linear-gradient(135deg,#eef2ff,#e0f2fe); border-radius:8px; display:flex; align-items:center; justify-content:center; color:#0f172a; font-weight:700; }
    .inline-help{ font-size:0.82rem; color:var(--muted); margin-top:6px; }
    .error{ color:#b91c1c; font-size:0.86rem; margin-top:6px; }
    footer{ margin-top:12px; font-size:0.82rem; color:var(--muted); }
  </style>
</head>
<body>
  <main class="container" aria-labelledby="title">
    <section class="card" aria-labelledby="title">
      <h1 id="title">Finalizar Compra</h1>

      <div class="field">
        <label for="product">Produto</label>
        <div style="display:flex;gap:12px;align-items:center">
          <div class="product-card">
            <div class="product-thumb" aria-hidden="true">PF</div>
            <div>
              <strong id="product-name">Produto Exemplo - Camiseta Oversized</strong>
              <div class="muted">Alguma descrição curta do produto.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="grid2">
        <div class="field">
          <label for="price">Preço unitário (R$)</label>
          <input id="price" type="number" step="0.01" value="79.90" aria-label="Preço unitário" />
        </div>
        <div class="field">
          <label for="quantity">Quantidade</label>
          <input id="quantity" type="number" min="1" value="1" />
        </div>
      </div>

      <hr style="margin:14px 0;border:none;border-top:1px solid #eef2f6" />

      <h2 style="font-size:1rem;margin:0 0 10px">Dados do comprador</h2>

      <div class="grid2">
        <div class="field">
          <label for="fullname">Nome completo</label>
          <input id="fullname" type="text" placeholder="Nome Sobrenome" required />
        </div>
        <div class="field">
          <label for="phone">Telefone</label>
          <input id="phone" type="tel" placeholder="+55 (11) 91234-5678" />
        </div>
      </div>

      <div class="grid2">
        <div class="field">
          <label for="email">E-mail</label>
          <input id="email" type="email" placeholder="seu@exemplo.com" required />
        </div>
        <div class="field">
          <label for="cpf">CPF (opcional)</label>
          <input id="cpf" type="text" inputmode="numeric" placeholder="000.000.000-00" />
        </div>
      </div>

      <div class="field">
        <label for="address">Endereço de entrega</label>
        <input id="address" type="text" placeholder="Rua, número, complemento" required />
        <div class="inline-help">CEP, bairro, cidade e estado serão solicitados abaixo.</div>
      </div>

      <div class="grid2">
        <div class="field">
          <label for="city">Cidade</label>
          <input id="city" type="text" placeholder="São Paulo" />
        </div>
        <div class="field">
          <label for="state">Estado</label>
          <select id="state" aria-label="Estado">
            <option value="">Escolha...</option>
            <option>SP</option><option>RJ</option><option>MG</option><option>BA</option><option>RS</option>
            <option>Outros</option>
          </select>
        </div>
      </div>

      <hr style="margin:14px 0;border:none;border-top:1px solid #eef2f6" />

      <h2 style="font-size:1rem;margin:0 0 10px">Pagamento</h2>

      <div class="notice" id="payment-notice">As transações aqui são simuladas — não envie dados reais em testes.</div>

      <div class="field">
        <label>Forma de pagamento</label>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <label><input type="radio" name="pay" value="card" checked /> Cartão</label>
          <label><input type="radio" name="pay" value="pix" /> Pix</label>
          <label><input type="radio" name="pay" value="boleto" /> Boleto</label>
        </div>
      </div>

      <div id="card-section">
        <div class="field">
          <label for="card-number">Número do cartão</label>
          <input id="card-number" type="text" inputmode="numeric" maxlength="19" placeholder="1234 5678 9012 3456" />
          <div class="inline-help">Apenas para validação do exemplo — aqui há verificação básica (Luhn).</div>
          <div id="card-error" class="error" role="alert" aria-live="polite" style="display:none"></div>
        </div>

        <div class="grid2">
          <div class="field">
            <label for="expiry">Validade (MM/AA)</label>
            <input id="expiry" type="text" maxlength="5" placeholder="08/26" />
          </div>
          <div class="field">
            <label for="cvv">CVV</label>
            <input id="cvv" type="text" inputmode="numeric" maxlength="4" placeholder="123" />
          </div>
        </div>

        <div class="field">
          <label for="card-name">Nome no cartão</label>
          <input id="card-name" type="text" placeholder="Como está escrito no cartão" />
        </div>
      </div>

      <div style="display:flex;gap:10px;align-items:center;margin-top:8px">
        <label style="display:flex;gap:8px;align-items:center">
          <input id="terms" type="checkbox" />
          <span class="small">Concordo com os <a href="#" onclick="return false">termos de compra</a></span>
        </label>
      </div>

      <div style="margin-top:12px; display:flex; gap:12px; align-items:center; justify-content:flex-start">
        <button id="buy" class="btn" type="button">Pagar agora</button>
        <div id="processing" class="muted" style="display:none">Processando...</div>
      </div>

      <footer>
        <div class="muted">Dúvidas? Contato: suporte@exemplo.com</div>
      </footer>
    </section>

    <aside class="card" aria-labelledby="summary-title">
      <h1 id="summary-title" style="font-size:1rem;margin-bottom:8px">Resumo do pedido</h1>

      <div class="summary">
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px">
          <div style="width:56px;height:56px;background:#eef2ff;border-radius:8px;display:flex;align-items:center;justify-content:center">IMG</div>
          <div>
            <div id="sum-name"><strong>Produto Exemplo - Camiseta Oversized</strong></div>
            <div class="muted" id="sum-opts">Tamanho: M · Cor: Preto</div>
          </div>
        </div>

        <div class="row"><div class="muted">Preço unit.</div><div id="sum-unit">R$ 79.90</div></div>
        <div class="row"><div class="muted">Quantidade</div><div id="sum-qty">1</div></div>
        <div class="row"><div class="muted">Frete</div><div id="sum-shipping">R$ 15.00</div></div>

        <hr style="border:none;border-top:1px solid #eef2f6;margin:12px 0" />

        <div class="row" style="font-weight:700"><div>Total</div><div id="sum-total">R$ 94.90</div></div>

        <div style="margin-top:10px" class="muted">Métodos de envio disponíveis: Padrão (3-7 dias), Expresso (1-3 dias).</div>
      </div>
    </aside>
  </main>

  <script>
    // --- Helpers ---
    const el = id => document.getElementById(id);
    const money = v => 'R$ ' + Number(v).toFixed(2).replace('.', ',');

    // initial
    const priceInput = el('price');
    const qtyInput = el('quantity');
    const shippingCost = 15.00;
    function updateSummary(){
      const unit = parseFloat(priceInput.value || 0);
      const qty = Math.max(1, parseInt(qtyInput.value || 1));
      el('sum-unit').textContent = money(unit);
      el('sum-qty').textContent = qty;
      el('sum-shipping').textContent = money(shippingCost);
      const total = unit * qty + shippingCost;
      el('sum-total').textContent = money(total);
    }
    updateSummary();
    priceInput.addEventListener('input', updateSummary);
    qtyInput.addEventListener('input', updateSummary);

    // Payment toggles
    const payRadios = document.querySelectorAll('input[name="pay"]');
    function onPayChange(){
      const val = document.querySelector('input[name="pay"]:checked').value;
      el('card-section').style.display = (val === 'card') ? 'block' : 'none';
    }
    payRadios.forEach(r=>r.addEventListener('change', onPayChange));
    onPayChange();

    // format card input (simple spacing)
    const cardInput = el('card-number');
    cardInput.addEventListener('input', e=>{
      let v = e.target.value.replace(/\D/g,'').slice(0,19);
      const parts = [];
      for(let i=0;i<v.length;i+=4) parts.push(v.slice(i,i+4));
      e.target.value = parts.join(' ');
    });

    // Luhn check
    function luhnCheck(number){
      const s = number.replace(/\D/g,'');
      let sum = 0, alt = false;
      for (let i = s.length - 1; i >= 0; i--) {
        let n = parseInt(s.charAt(i), 10);
        if (alt) {
          n *= 2;
          if (n > 9) n -= 9;
        }
        sum += n;
        alt = !alt;
      }
      return (sum % 10) === 0 && s.length >= 12;
    }

    // expiry validation mm/aa
    function validExpiry(exp){
      if (!/^\d{2}\/\d{2}$/.test(exp)) return false;
      const [mm, yy] = exp.split('/');
      const month = parseInt(mm,10);
      const year = 2000 + parseInt(yy,10);
      if (month < 1 || month > 12) return false;
      const now = new Date();
      const cmp = new Date(year, month);
      return cmp > now;
    }

    // Submit handling (simulated)
    el('buy').addEventListener('click', async function(){
      // basic required validation
      const required = [
        {id:'fullname', name:'Nome'},
        {id:'email', name:'E-mail'},
        {id:'address', name:'Endereço'}
      ];
      for (const r of required){
        const v = el(r.id).value.trim();
        if (!v){
          alert('Preencha: ' + r.name);
          el(r.id).focus();
          return;
        }
      }
      if (!el('terms').checked){
        alert('Você deve concordar com os termos de compra.');
        return;
      }

      const payMethod = document.querySelector('input[name="pay"]:checked').value;
      if (payMethod === 'card'){
        const num = el('card-number').value.trim();
        const exp = el('expiry').value.trim();
        const cvv = el('cvv').value.trim();
        el('card-error').style.display = 'none';

        if (!num || !exp || !cvv){
          el('card-error').textContent = 'Preencha os dados do cartão.';
          el('card-error').style.display = 'block';
          return;
        }
        if (!luhnCheck(num)){
          el('card-error').textContent = 'Número do cartão inválido (verificação Luhn falhou).';
          el('card-error').style.display = 'block';
          return;
        }
        if (!validExpiry(exp)){
          el('card-error').textContent = 'Validade inválida ou cartão vencido.';
          el('card-error').style.display = 'block';
          return;
        }
      }

      // Simula processamento
      el('buy').disabled = true;
      el('processing').style.display = 'inline';
      try {
        // Aqui normalmente faria um fetch() para servidor; simulamos:
        await new Promise(r => setTimeout(r, 900));
        const totalText = el('sum-total').textContent;
        alert('Pagamento realizado com sucesso! Total: ' + totalText);
        // opcional: limpar form ou redirecionar
      } finally {
        el('buy').disabled = false;
        el('processing').style.display = 'none';
      }
    });

    // Small UX: format expiry while typing
    const expiry = el('expiry');
    expiry.addEventListener('input', (e) => {
      let v = e.target.value.replace(/\D/g,'').slice(0,4);
      if (v.length >= 3) v = v.slice(0,2) + '/' + v.slice(2);
      e.target.value = v;
    });
  </script>
</body>
</html>
